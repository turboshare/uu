<!DOCTYPE html>
<html lang="en" >

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tron Highrisk DAPP</title>

    <link rel="stylesheet" href="https://turboshare.github.io/uu/home/app.6c437bda.css">
</head>

<body>
    <div class="container mt-5">

        <div class="row mb-5">
            <div class="col-12 d-flex align-items-center justify-content-center">
                <h1>Tron Highrisk DAPP
                </h1>
            </div>

        </div>

        <div class="row ">
            <div class="col-12 col-md-6 cell-content-left">
                <h3>Total Invested
                </h3>
            </div>

            <div class="col-12 col-md-6 cell-content-right">
                <h3 ><span id="totalInvested">0</span> MATIC</h3>
            </div>
        </div>


        <div class="row mt-1">
            <div class="col-12 col-md-6 cell-content-left">
                <h3>Total referral rewards
                </h3>
            </div>

            <div class="col-12 col-md-6 cell-content-right">
                <h3 ><span id="totalRefRewards">0</span> MATIC</h3>
            </div>
        </div>


        <div class="row mt-1">
            <div class="col-12 col-md-6 cell-content-left">
                <h3>Your Investment 
                </h3>
            </div>

            <div class="col-12 col-md-6 cell-content-right">
                <h3 ><span id="invested">0</span> MATIC</h3>
            </div>
        </div>


        <div class="row mt-1">
            <div class="col-12 col-md-6 cell-content-left">
                <h3>Your Referral rewards
                </h3>
            </div>

            <div class="col-12 col-md-6 cell-content-right">
                <h3 ><span id="refRewards">0</span> MATIC</h3>
            </div>
        </div>


        <div class="row mt-5">

            <div class="col-12 col-sm-4">
                <div class="card ">
                    <div class="card-header d-flex align-items-center justify-content-center">
                        <h4>Plan A</h4>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center justify-content-center mb-1 font-weight-bold">
                            <h5>8 days</h5>
                        </div>
                        <div class="d-flex align-items-center justify-content-center mb-1 font-weight-bold">
                            <h5>Returns 140%</h5>
                        </div>
                        <div class="input-group mt-1" >
                            <input type="number" class="form-control" id="investValue1" />
                            <div class="input-group-append">
                                <span class="input-group-text" id>MATIC</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-center">
                        <button class="btn btn-primary w-100 v-md-50 font-weight-bold btn-invest" id="btnInvest1">
                            Invest
                        </button>
                    </div>
                </div>
            </div>





            <div class="col-12 col-sm-4">
                <div class="card ">
                    <div class="card-header d-flex align-items-center justify-content-center">
                        <h4>Plan B</h4>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center justify-content-center mb-1 font-weight-bold">
                            <h5>12 days</h5>
                        </div>
                        <div class="d-flex align-items-center justify-content-center mb-1 font-weight-bold">
                            <h5>Returns 160%</h5>
                        </div>
                        <div class="input-group mt-1" >
                            <input type="number" class="form-control" id="investValue2" />
                            <div class="input-group-append">
                                <span class="input-group-text" id>MATIC</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-center">
                        <button class="btn btn-primary w-100 v-md-50 font-weight-bold btn-invest" id="btnInvest2">
                            Invest
                        </button>
                    </div>
                </div>
            </div>



            <div class="col-12 col-sm-4">
                <div class="card ">
                    <div class="card-header d-flex align-items-center justify-content-center">
                        <h4>Plan C</h4>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center justify-content-center mb-1 font-weight-bold">
                            <h5>20 days</h5>
                        </div>
                        <div class="d-flex align-items-center justify-content-center mb-1 font-weight-bold">
                            <h5>Returns 200%</h5>
                        </div>
                        <div class="input-group mt-1" >
                            <input type="number" class="form-control" id="investValue3" />
                            <div class="input-group-append">
                                <span class="input-group-text" id>MATIC</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-center">
                        <button class="btn btn-primary w-100 v-md-50 font-weight-bold btn-invest" id="btnInvest3">
                            Invest
                        </button>
                    </div>
                </div>
            </div>





        </div>


        <div class="input-group mt-2" >
            <input type="text" class="form-control" id="referral" />
            <div class="input-group-append">
                <span class="input-group-text" id>Referrer</span>
            </div>
        </div>

        <div class="row mt-5 border p-3 rounded mb-5 ml-0 mr-0">

            <div class="col-12 col-md-6 cell-content-right">
                <h3>Withdrawable
                </h3>
            </div>

            <div class="col-12 col-md-6 cell-content-left">
                <h3 ><span id="withdrawable">0</span> MATIC</h3>
            </div>

            <div class="col-12 mt-2">
                <button class="btn btn-success w-100 v-md-50 font-weight-bold btn-invest" id="btnWithdraw">
                    Withdraw
                </button>
            </div>

        </div>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Timestamp</th>
                    <th scope="col">User</th>
                    <th scope="col">Amount</th>
                </tr>
            </thead>
            <tbody id="tblEvents">


            </tbody>
        </table>


    </div>

    <script> 
    var myContractInstance;
var abi = [
	{
		"constant": false,
		"inputs": [
			{
				"name": "tariff",
				"type": "uint256"
			},
			{
				"name": "referrer",
				"type": "address"
			}
		],
		"name": "invest",
		"outputs": [],
		"payable": true,
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "pause",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "unpause",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [],
		"name": "withdraw",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "InvestedAt",
		"type": "event"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "investors",
		"outputs": [
			{
				"name": "registered",
				"type": "bool"
			},
			{
				"name": "referrer",
				"type": "address"
			},
			{
				"name": "referral_counter",
				"type": "uint256"
			},
			{
				"name": "balanceRef",
				"type": "uint256"
			},
			{
				"name": "totalRef",
				"type": "uint256"
			},
			{
				"name": "invested",
				"type": "uint256"
			},
			{
				"name": "lastPaidAt",
				"type": "uint256"
			},
			{
				"name": "withdrawn",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "tariffs",
		"outputs": [
			{
				"name": "time",
				"type": "uint256"
			},
			{
				"name": "percent",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "totalInvested",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "totalInvestors",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "totalRefRewards",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "user",
				"type": "address"
			}
		],
		"name": "withdrawable",
		"outputs": [
			{
				"name": "amount",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
]
        var address = "0xcb61529a79f6c42f10fba04a54f30edd7ab7de18";
$(document).ready(function () {
    if (typeof web3 !== 'undefined') {

        web3 = new Web3(web3.currentProvider);
        MyContract = new web3.eth.Contract(abi, address);
        myContractInstance = MyContract;

        if (web3.currentProvider.isTrust) {

            const infura = 'https://polygon-mainnet.infura.io/v3/c2b1f9ce72254350a04f5759c898c8b3';
            const web3 = new Web3(new Web3.providers.HttpProvider(infura));
            MyContract = new web3.eth.Contract(abi, address);
            myContractInstance = MyContract;

        }

    } else {

        const infura = 'https://polygon-mainnet.infura.io/v3/c2b1f9ce72254350a04f5759c898c8b3';
        const web3 = new Web3(new Web3.providers.HttpProvider(infura));
        MyContract = new web3.eth.Contract(abi, address);
        myContractInstance = MyContract;

    }
    // get variable values

document.getElementById('referral').value=DEFAULT_REFERRER_ADDRESS;


document.getElementById('btnInvest1').addEventListener("click", function () {
    invest(1)
});
document.getElementById('btnInvest2').addEventListener("click", function () {
    invest(2)
});
document.getElementById('btnInvest3').addEventListener("click", function () {
    invest(3)
});
document.getElementById('btnWithdraw').addEventListener("click", function () {
    withdraw()

});


})






async function invest(plan) {
    let contract=await getContract();
  
    if(contract){

        let referral = document.getElementById('referral').value;
    
        let value=document.getElementById('investValue' + plan).value;
    
        contract.invest(plan,referral).send({
            feeLimit: 100_000_000,
            callValue: value * 1000000,
            shouldPollResponse: true
        });
    }



}




async function withdraw() {
    let contract=await getContract();
    if(contract){
        contract.withdraw().send({
            feeLimit: 100_000_000,
            shouldPollResponse: true
        });
    }

}



function walletInstalled(){
    if (window.web3.eth && window.web3.eth.defaultAddress.base58) {
        return true;
    } else {
        return false;
    } 
}



async function getContract(){
    if(walletInstalled()){
        return window.web3.contract().at(CONTRACT_ADDRESS);
    }
}


async function readInfo(){
    let contract=await getContract();

    if(contract){
        contract.totalInvested().call().then(function(data){
            let totalInvested=window.web3.toDecimal(data["_hex"]);
            document.getElementById('totalInvested').innerHTML=totalInvested / 1000000;
        })
        contract.totalRefRewards().call().then(function(data){
            let totalRefRewards=window.web3.toDecimal(data["_hex"]);
            document.getElementById('totalRefRewards').innerHTML=totalRefRewards / 1000000;
        })
    
        contract.investors(window.web3.defaultAddress.base58).call().then(function(data){
            document.getElementById('invested').innerHTML=window.web3.toDecimal(data['invested']["_hex"]) / 1000000;
            document.getElementById('refRewards').innerHTML=window.web3.toDecimal(data['totalRef']["_hex"]) / 1000000;
        })
    
        contract.withdrawable(window.web3.defaultAddress.base58).call().then(function(data){
            document.getElementById('withdrawable').innerHTML=window.web3.toDecimal(data['amount']["_hex"]) / 1000000;
        })
    }

}

async function readEvents(){
    let contract=await getContract();

    if(contract){
        web3.eth.getEventResult(CONTRACT_ADDRESS, {size:10})
        .then(function(data){
            let res='';
            let index=1;
            data.forEach(function(event){
                res= res + " <tr>";
                res= res + " <td>" + index + "</td>";
                res= res + " <td>" + event['timestamp'] + "</td>";
                res= res + " <td>" + event['result']['user'] + "</td>";
                res= res + " <td>" + event['result']['value']/1000000 + " MATIC</td>";
                res= res + " </tr>";
                index++;
            })
            document.getElementById('tblEvents').innerHTML=res;
        })
        .catch(function(error){
            console.log(error);
        });
    }
}

    
    </script>
</body>

</html>
